<!-- Embed this file in a WordPress Custom HTML block to avoid entity encoding -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SQMU Purchase</title>
  <style>
    body { font-family: sans-serif; margin: 20px auto; max-width: 420px; text-align: center; }
    input, select, button { margin: 5px 0; padding: 6px 12px; font-size: 1em; }
  </style>
</head>
<body>
  <h3>Buy SQMU3</h3>
  <p>Token to receive: <b>SQMU3</b> on <b>Polygon</b></p>
  <label>Amount in USD<br>
    <input id="usd-input" type="number" min="1" step="0.01" placeholder="e.g. 25">
  </label>
  <div>
    <select id="network-select">
      <option value="0">USDT (Ethereum)</option>
      <option value="1">USDC (Arbitrum)</option>
      <option value="2">USDC (Polygon)</option>
    </select>
  </div>
  <button id="pay-btn">Continue to Pay</button>

  <!-- Direct string concatenation can be corrupted when pasted in visual editors -->
  <script>
    const TARGET = { token: 'SQMU3', chainId: 137 };
    document.getElementById('pay-btn').onclick = function() {
      const titleEl = document.querySelector('.property-title');
      const pageTitle = titleEl ? titleEl.textContent : document.title;

      const priceEl = document.querySelector('.es-price');
      let usd, aed;
      if (priceEl) {
        const match = priceEl.textContent.replace(/,/g, '').match(/AED\s*([\d.]+)/i);
        if (match) {
          aed = parseFloat(match[1]);
          usd = (aed / 3.67).toFixed(2);
        }
      } else {
        usd = document.getElementById('usd-input').value;
        if (usd) {
          aed = (parseFloat(usd) * 3.67).toFixed(2);
        }
      }
      if (!usd || isNaN(usd) || +usd <= 0) {
        alert('Enter a valid USD amount');
        return;
      }
      const idx = document.getElementById('network-select').value;
      const tokens = ['USDT','USDC','USDC'];
      const chains = [1,42161,137];
      const url = new URL('Metamask%202.1.html', location.href);
      url.searchParams.set('title', pageTitle);
      if (aed) {
        url.searchParams.set('aed', aed);
      }
      url.searchParams.set('usd', usd);
      url.searchParams.set('token', tokens[idx]);
      url.searchParams.set('chain', chains[idx]);
      url.searchParams.set('buy', TARGET.token);
      url.searchParams.set('buyChain', TARGET.chainId);
      window.open(url.toString(), '_blank');
    };
  </script>
</body>
</html>
